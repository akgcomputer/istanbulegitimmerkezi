---
// kurs-bilisim/[slug].astro
import Layout from '../../layouts/Layout.astro';
import ContactButtons from '../../components/ContactButtons.astro';
import { courses } from '../../data/courses-sanat';

export async function getStaticPaths() {
  return courses.map((course) => ({
    params: { slug: course.slug },
    props: { course },
  }));
}

const { slug } = Astro.params;
const course = courses.find(c => c.slug === slug);

const renderStars = (rating) => {
  if (!rating) return '';
  const fullStars = Math.floor(rating);
  return 'â˜…'.repeat(fullStars);
};

// Benzer eÄŸitimler (en fazla 3)
let similarCourses = [];
if (course?.category) {
  similarCourses = courses
    .filter(c => c.category === course.category && c.slug !== course.slug)
    .slice(0, 3);
}

// EÄŸitmen renkleri iÃ§in (yanÄ±p sÃ¶nen noktalar)
const instructorColors = ['bg-red-500', 'bg-orange-500', 'bg-green-500'];
---

<Layout title={course?.title ? `${course.title} | Ä°stanbul EÄŸitim Merkezi` : "Kurs BulunamadÄ±"}>
  {course ? (
    <div class="max-w-6xl mx-auto px-4 py-8">
      <!-- Ãœst KÄ±sÄ±m: Resim + BaÅŸlÄ±k/EÄŸitmenler -->
      <div class="flex flex-col lg:flex-row gap-8 mb-12">
        <!-- Sol: Resim (kÄ±rmÄ±zÄ± led) -->
        <div class="lg:w-2/5">
          <div class="sticky top-24 shadow-[0_10px_30px_-5px_rgba(220,38,38,0.6)] rounded-2xl overflow-hidden">
            <img 
              src={course.image} 
              alt={course.title} 
              class="w-full h-auto object-cover aspect-[3/2]"
              width="750" 
              height="420" 
            />
          </div>
        </div>

        <!-- SaÄŸ: BaÅŸlÄ±k, eÄŸitmenler, butonlar -->
        <div class="lg:w-3/5">
          <div class="mb-6">
            <span class="text-sm font-semibold text-indigo-600 uppercase tracking-wider">
              {course.breadcrumb}
            </span>
            <h1 class="text-4xl font-bold text-gray-900 mt-2 leading-tight">
              {course.title}
            </h1>
          </div>

          <!-- EÄŸitmenler bÃ¶lÃ¼mÃ¼ (ilk 3 + baÄŸlantÄ±lar) -->
          <div class="mb-8">
            <h2 class="text-2xl font-semibold text-gray-800 mb-4 flex items-center gap-2">
              <span class="text-yellow-400 text-2xl">â­</span>
              EÄŸitmenler ve Ãœcretler
            </h2>

            <div class="overflow-x-auto rounded-xl border border-gray-200">
              <table class="w-full text-sm">
                <thead class="bg-gray-50">
                  <tr>
                    <th class="px-4 py-3 text-left font-medium text-gray-600">EÄŸitmen</th>
                    <th class="px-4 py-3 text-left font-medium text-gray-600">Ã–zel</th>
                    <th class="px-4 py-3 text-left font-medium text-gray-600">Grup</th>
                    <th class="px-4 py-3 text-left font-medium text-gray-600">Kurumsal</th>
                    <th class="px-4 py-3 text-left font-medium text-gray-600">Online</th>
                    <th class="px-4 py-3 text-left font-medium text-gray-600">Lokasyon</th>
                  </tr>
                </thead>
                <tbody class="divide-y divide-gray-100">
                  {course.instructors?.slice(0, 3).map((ins, index) => (
                    <tr class="hover:bg-gray-50 transition">
                      <td class="px-4 py-3">
                        <a href={`/egitmen/${ins.slug}`} class="flex items-center gap-2 group">
                          <span class={`w-2 h-2 rounded-full animate-pulse ${instructorColors[index % 3]}`}></span>
                          <span class="font-medium text-gray-900 group-hover:text-indigo-600">
                            {ins.name}
                          </span>
                        </a>
                        <div class="text-xs text-gray-500 mt-1">{ins.since}'den beri</div>
                      </td>
                      <td class="px-4 py-3 font-semibold text-indigo-600">{ins.privatePrice}â‚º</td>
                      <td class="px-4 py-3">{ins.groupPrice}â‚º</td>
                      <td class="px-4 py-3">
                        <span class={ins.corporate ? "text-green-600 text-lg" : "text-red-600 text-lg"}>
                          {ins.corporate ? 'âœ“' : 'âœ—'}
                        </span>
                      </td>
                      <td class="px-4 py-3">
                        <span class={ins.online ? "text-green-600 text-lg" : "text-red-600 text-lg"}>
                          {ins.online ? 'âœ“' : 'âœ—'}
                        </span>
                      </td>
                      <td class="px-4 py-3 text-gray-600">{ins.location}</td>
                    </tr>
                  ))}
                </tbody>
              </table>
            </div>

            <!-- Alt baÄŸlantÄ±lar -->
            <div class="mt-4 flex flex-wrap items-center justify-between gap-4 p-4 bg-gradient-to-r from-indigo-50 to-purple-50 rounded-xl">
              <div class="flex items-center gap-2">
                <span class="text-indigo-600 font-bold">{Math.max(0, course.instructors.length - 3)}+</span>
                <span>eÄŸitmen daha bu dersi veriyor.</span>
                <a href="/egitmenler" class="text-indigo-600 hover:text-indigo-800 font-semibold underline decoration-2 underline-offset-2">
                  TÃ¼mÃ¼nÃ¼ GÃ¶r â†’
                </a>
              </div>
              <a 
                href="/egitmen-basvuru" 
                target="_blank"
                class="flex items-center gap-2 bg-orange-500 hover:bg-orange-600 text-white px-4 py-2 rounded-full transition-all shadow-md hover:shadow-lg"
              >
                <span class="text-lg">âœ¨</span>
                Siz de eÄŸitmen olun
                <span class="text-xs opacity-70">â†—</span>
              </a>
            </div>
          </div>

          <!-- Butonlar: Derse Kaydol + WhatsApp + Ara -->
          <div class="space-y-3">
            <ContactButtons courseTitle={course.title} />
          </div>
          <p class="text-sm text-gray-500 italic">
            * Derse kaydol adÄ±mÄ±nÄ± takip ederek baÅŸvuru formunu doldurup derse kaydolabilir,
            <br>formda eÄŸitmen tercihinde bulunabilirsiniz.
          </p>
        </div>
      </div>

      <!-- Alt KÄ±sÄ±m: AÃ§Ä±klama kutularÄ± -->
      <div class="space-y-8 mt-16">
        <!-- EÄŸitim HakkÄ±nda (sarÄ± led) -->
        <div class="bg-white rounded-2xl p-8 shadow-[0_10px_30px_-5px_rgba(250,204,21,0.6)] border border-gray-100">
          <h2 class="text-2xl font-bold text-gray-900 mb-4">EÄŸitim HakkÄ±nda</h2>
          <p class="text-gray-700 leading-relaxed text-lg">{course.description}</p>
        </div>

        <!-- ÃœÃ§lÃ¼ grid: Neden, Ä°stihdam, Gereksinimler -->
        <div class="grid grid-cols-1 md:grid-cols-3 gap-6">
          <!-- Neden AlmalÄ±sÄ±nÄ±z? (mavi led) -->
          <div class="bg-white rounded-2xl p-6 shadow-[0_10px_30px_-5px_rgba(37,99,235,0.6)] border border-gray-100">
            <h3 class="font-semibold text-gray-900 text-lg mb-2 flex items-center gap-2">
              <span>ğŸ¯</span> Neden AlmalÄ±sÄ±nÄ±z?
            </h3>
            <p class="text-gray-700">{course.whyTake}</p>
          </div>

          <!-- Ä°stihdam AlanlarÄ± (pembe led) -->
          <div class="bg-white rounded-2xl p-6 shadow-[0_10px_30px_-5px_rgba(219,39,119,0.6)] border border-gray-100">
            <h3 class="font-semibold text-gray-900 text-lg mb-2 flex items-center gap-2">
              <span>ğŸ’¼</span> Ä°stihdam AlanlarÄ±
            </h3>
            <p class="text-gray-700">{course.employmentAreas}</p>
          </div>

          <!-- Gereksinimler (pembe led - aynÄ± renk, istersen deÄŸiÅŸiriz) -->
          <div class="bg-white rounded-2xl p-6 shadow-[0_10px_30px_-5px_rgba(219,39,119,0.6)] border border-gray-100">
            <h3 class="font-semibold text-gray-900 text-lg mb-2 flex items-center gap-2">
              <span>ğŸ“‹</span> Gereksinimler
            </h3>
            <p class="text-gray-700">{course.requirements || "Herhangi bir Ã¶n koÅŸul bulunmamaktadÄ±r."}</p>
          </div>
        </div>
      </div>

      <!-- Benzer EÄŸitimler -->
      {similarCourses.length > 0 && (
        <div class="mt-16">
          <h2 class="text-2xl font-bold text-gray-900 mb-6 inline-block shadow-[0_8px_20px_-5px_rgba(34,197,94,0.6)] p-2 rounded-lg">
            ğŸ” Bu eÄŸitimi inceleyenler ÅŸunlarÄ± da inceledi
          </h2>
          <div class="grid grid-cols-1 sm:grid-cols-2 lg:grid-cols-3 gap-6 mt-4">
            {similarCourses.map((similar) => (
              <a 
                href={`/kurs-bilisim/${similar.slug}`} 
                class="group bg-white rounded-xl shadow-[0_8px_20px_-5px_rgba(220,38,38,0.5)] border border-gray-200 overflow-hidden hover:shadow-[0_12px_30px_-5px_rgba(220,38,38,0.7)] transition-all"
              >
                <img 
                  src={similar.image} 
                  alt={similar.title} 
                  class="w-full h-40 object-cover"
                  width="400" 
                  height="200" 
                />
                <div class="p-4">
                  <h3 class="font-semibold text-gray-800 group-hover:text-indigo-600">
                    {similar.title}
                  </h3>
                  <p class="text-sm text-gray-500 mt-1">{similar.breadcrumb}</p>
                  <div class="mt-2 flex items-center justify-between">
                    <span class="text-indigo-600 font-bold">{similar.instructors[0].privatePrice}â‚º'den</span>
                    <span class="text-xs text-gray-400">{similar.instructors.length} eÄŸitmen</span>
                  </div>
                </div>
              </a>
            ))}
          </div>
        </div>
      )}

      <!-- Alt not -->
      <div class="mt-12 text-center text-sm text-gray-500 border-t pt-8">
        * Fiyatlar eÄŸitmene ve eÄŸitim tipine gÃ¶re deÄŸiÅŸiklik gÃ¶sterebilir.
      </div>
    </div>
  ) : (
    <div class="bg-red-100 p-8 text-center">
      <h1 class="text-2xl font-bold text-red-600">Kurs BulunamadÄ±</h1>
      <p class="mt-2">AradÄ±ÄŸÄ±nÄ±z kurs: {slug}</p>
    </div>
  )}
</Layout>