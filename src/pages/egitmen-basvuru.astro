---
// src/pages/ders-kayit-form.astro
import Layout from '../layouts/Layout.astro';
import ContactButtons from '../components/ContactButtons.astro';

// Meta bilgiler
const meta = {
  title: 'Derse Kaydol / Ä°letiÅŸim | Ä°stanbul EÄŸitim Merkezi',
  description: 'Ders kaydÄ± ve iletiÅŸim formu. Size en uygun eÄŸitmen ve ders programÄ± iÃ§in hemen baÅŸvurun.'
};

// Konular (iletiÅŸim formu iÃ§in)
const konular = [
  'Genel Bilgi',
  'Fiyat Bilgisi',
  'Teknik Destek',
  'Åikayet/Ã–neri',
  'DiÄŸer'
];
---

<Layout title={meta.title} description={meta.description}>
  <div class="max-w-3xl mx-auto px-4 py-12 md:py-16">
    
    <!-- BaÅŸlÄ±k -->
    <div class="text-center mb-8">
      <h1 class="text-3xl md:text-4xl lg:text-5xl font-bold text-gray-900 mb-4">EÄŸitmen BaÅŸvurusu Yap veya Ä°letiÅŸim Kur</h1>
      <div class="w-24 h-1 bg-indigo-600 mx-auto mb-6"></div>
      <p class="text-lg text-gray-600 max-w-2xl mx-auto">
        YetkinliÄŸiniz olan tÃ¼m derslerde ÅŸimdi baÅŸvurabilirsiniz. 
        BaÅŸvurunuz ardÄ±ndan gÃ¼n iÃ§inde sizi bilgilendireceÄŸiz.
      </p>
    </div>

    <!-- Sekmeler -->
    <div class="bg-white rounded-2xl shadow-xl border border-gray-200 overflow-hidden">
      
      <!-- Sekme BaÅŸlÄ±klarÄ± -->
      <div class="flex border-b border-gray-200">
        <button 
          id="tabDersKaydi" 
          class="flex-1 py-4 px-6 text-center font-semibold text-lg transition-colors bg-indigo-600 text-white"
          onclick="switchTab('ders')"
        >
          ğŸ“ EÄŸitmen KaydÄ±
        </button>
        <button 
          id="tabIletisim" 
          class="flex-1 py-4 px-6 text-center font-semibold text-lg transition-colors bg-gray-50 text-gray-700 hover:bg-gray-100"
          onclick="switchTab('iletisim')"
        >
          ğŸ’¬ Ä°letiÅŸim Kur
        </button>
      </div>

      <!-- Ders KaydÄ± Formu -->
      <div id="formDersKaydi" class="p-6 md:p-8">
        <form id="dersKaydiForm" method="POST" action="/api/kayit" class="space-y-5">
          
          <!-- Ad Soyad -->
          <div>
            <label for="adSoyad" class="block text-sm font-medium text-gray-700 mb-1">
              Ad Soyad <span class="text-red-500">*</span>
            </label>
            <input 
              type="text" 
              id="adSoyad" 
              name="adSoyad" 
              required
              class="w-full px-4 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-indigo-500 focus:border-indigo-500 transition"
              placeholder="AdÄ±nÄ±z ve soyadÄ±nÄ±z"
            >
          </div>

          <!-- Telefon -->
          <div>
            <label for="telefon" class="block text-sm font-medium text-gray-700 mb-1">
              Telefon <span class="text-red-500">*</span>
            </label>
            <input 
              type="tel" 
              id="telefon" 
              name="telefon" 
              required
              class="w-full px-4 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-indigo-500 focus:border-indigo-500 transition"
              placeholder="05XX XXX XX XX"
            >
          </div>

          <!-- E-posta (zorunlu deÄŸil) -->
          <div>
            <label for="email" class="block text-sm font-medium text-gray-700 mb-1">
              E-posta Adresi
            </label>
            <input 
              type="email" 
              id="email" 
              name="email" 
              class="w-full px-4 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-indigo-500 focus:border-indigo-500 transition"
              placeholder="ornek@email.com (opsiyonel)"
            >
            <p class="text-xs text-gray-500 mt-1">E-posta girerseniz size bilgilendirme gÃ¶nderebiliriz.</p>
          </div>

          <!-- Ders AdÄ± (KullanÄ±cÄ± yazacak) -->
          <div>
            <label for="dersAdi" class="block text-sm font-medium text-gray-700 mb-1">
              UzmanlÄ±ÄŸÄ±nÄ±z Olan Ders AdlarÄ±nÄ± YazÄ±n<span class="text-red-500">*</span>
            </label>
            <input 
              type="text" 
              id="dersAdi" 
              name="dersAdi" 
              required
              class="w-full px-4 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-indigo-500 focus:border-indigo-500 transition"
              placeholder="Ã–rn: Ä°ngilizce, Matematik, Python Programlama"
            >
          </div>

          <!-- EÄŸitmen AdÄ± (KullanÄ±cÄ± yazacak - opsiyonel) -->
          <div>
            <label for="egitmenAdi" class="block text-sm font-medium text-gray-700 mb-1">
              Varsa Referans EÄŸitmen AdÄ± (opsiyonel)
            </label>
            <input 
              type="text" 
              id="egitmenAdi" 
              name="egitmenAdi" 
              class="w-full px-4 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-indigo-500 focus:border-indigo-500 transition"
              placeholder="Varsa eÄŸitmen adÄ± yazÄ±n"
            >
          </div>

          <!-- EÄŸitim TÃ¼rÃ¼ -->
          <div>
            <label class="block text-sm font-medium text-gray-700 mb-2">
              EÄŸitim TÃ¼rÃ¼ SeÃ§iniz, seÃ§im dÄ±ÅŸÄ±nda gelecek talepler de tarafÄ±nÄ±za iletilecektir.<span class="text-red-500">*</span>
            </label>
            <div class="grid sm:grid-cols-2 gap-3">
              <label class="flex items-center gap-2 p-3 border border-gray-200 rounded-lg hover:bg-indigo-50 cursor-pointer">
                <input type="radio" name="egitimTuru" value="yuz-yuze-birebir" required class="text-indigo-600 focus:ring-indigo-500">
                <span class="text-sm">ğŸ¯ YÃ¼z yÃ¼ze - Birebir Ã–zel Ders</span>
              </label>
              <label class="flex items-center gap-2 p-3 border border-gray-200 rounded-lg hover:bg-indigo-50 cursor-pointer">
                <input type="radio" name="egitimTuru" value="yuz-yuze-grup" required class="text-indigo-600 focus:ring-indigo-500">
                <span class="text-sm">ğŸ‘¥ YÃ¼z yÃ¼ze - Grup Dersi</span>
              </label>
              <label class="flex items-center gap-2 p-3 border border-gray-200 rounded-lg hover:bg-indigo-50 cursor-pointer">
                <input type="radio" name="egitimTuru" value="online-birebir" required class="text-indigo-600 focus:ring-indigo-500">
                <span class="text-sm">ğŸ’» Online - Birebir Ã–zel Ders</span>
              </label>
              <label class="flex items-center gap-2 p-3 border border-gray-200 rounded-lg hover:bg-indigo-50 cursor-pointer">
                <input type="radio" name="egitimTuru" value="online-grup" required class="text-indigo-600 focus:ring-indigo-500">
                <span class="text-sm">ğŸŒ Online - Grup Dersi</span>
              </label>
            </div>
          </div>

          <!-- Åehir (isteÄŸe baÄŸlÄ±) -->
          <div>
            <label for="sehir" class="block text-sm font-medium text-gray-700 mb-1">
              Åehir
            </label>
            <input 
              type="text" 
              id="sehir" 
              name="sehir" 
              class="w-full px-4 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-indigo-500 focus:border-indigo-500 transition"
              placeholder="Ã–rn. Ankara, Ä°stanbul, Ä°zmir, vb."
            >
          </div>

          <!-- Gizli Alanlar -->
          <input type="hidden" name="formTipi" value="ders">

          <!-- GÃ¶nder Butonu -->
          <div class="pt-4">
            <button 
              type="submit" 
              class="w-full bg-indigo-600 hover:bg-indigo-700 text-white font-semibold py-3 px-6 rounded-lg transition flex items-center justify-center gap-2"
            >
              <svg class="w-5 h-5" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M5 13l4 4L19 7" />
              </svg>
              Kaydol
            </button>
          </div>
        </form>
      </div>

      <!-- Ä°letiÅŸim Formu -->
      <div id="formIletisim" class="p-6 md:p-8 hidden">
        <form id="iletisimForm" method="POST" action="/api/kayit" class="space-y-5">
          
          <!-- Ad Soyad -->
          <div>
            <label for="iletisimAdSoyad" class="block text-sm font-medium text-gray-700 mb-1">
              Ad Soyad <span class="text-red-500">*</span>
            </label>
            <input 
              type="text" 
              id="iletisimAdSoyad" 
              name="adSoyad" 
              required
              class="w-full px-4 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-indigo-500 focus:border-indigo-500 transition"
              placeholder="AdÄ±nÄ±z ve soyadÄ±nÄ±z"
            >
          </div>

          <!-- Telefon -->
          <div>
            <label for="iletisimTelefon" class="block text-sm font-medium text-gray-700 mb-1">
              Telefon <span class="text-red-500">*</span>
            </label>
            <input 
              type="tel" 
              id="iletisimTelefon" 
              name="telefon" 
              required
              class="w-full px-4 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-indigo-500 focus:border-indigo-500 transition"
              placeholder="05XX XXX XX XX"
            >
          </div>

          <!-- E-posta (zorunlu deÄŸil) -->
          <div>
            <label for="iletisimEmail" class="block text-sm font-medium text-gray-700 mb-1">
              E-posta Adresi
            </label>
            <input 
              type="email" 
              id="iletisimEmail" 
              name="email" 
              class="w-full px-4 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-indigo-500 focus:border-indigo-500 transition"
              placeholder="ornek@email.com (opsiyonel)"
            >
          </div>

          <!-- Konu -->
          <div>
            <label for="konu" class="block text-sm font-medium text-gray-700 mb-1">
              Konu <span class="text-red-500">*</span>
            </label>
            <select 
              id="konu" 
              name="konu" 
              required
              class="w-full px-4 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-indigo-500 focus:border-indigo-500 transition"
            >
              <option value="">Konu seÃ§iniz</option>
              {konular.map((konu) => (
                <option value={konu}>{konu}</option>
              ))}
            </select>
          </div>

          <!-- Mesaj -->
          <div>
            <label for="mesaj" class="block text-sm font-medium text-gray-700 mb-1">
              MesajÄ±nÄ±z <span class="text-red-500">*</span>
            </label>
            <textarea 
              id="mesaj" 
              name="mesaj" 
              rows="4"
              required
              class="w-full px-4 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-indigo-500 focus:border-indigo-500 transition"
              placeholder="MesajÄ±nÄ±zÄ± yazÄ±n..."
            ></textarea>
          </div>

          <!-- Gizli Alanlar -->
          <input type="hidden" name="formTipi" value="iletisim">

          <!-- GÃ¶nder Butonu -->
          <div class="pt-4">
            <button 
              type="submit" 
              class="w-full bg-indigo-600 hover:bg-indigo-700 text-white font-semibold py-3 px-6 rounded-lg transition flex items-center justify-center gap-2"
            >
              <svg class="w-5 h-5" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M12 19l9 2-9-18-9 18 9-2zm0 0v-8" />
              </svg>
              GÃ¶nder
            </button>
          </div>
        </form>
      </div>
    </div>

    <!-- HÄ±zlÄ± Ä°letiÅŸim ButonlarÄ± (ContactButtons) -->
    <div class="mt-8 text-center">
      <p class="text-gray-600 mb-4">HÄ±zlÄ± iletiÅŸim iÃ§in:</p>
      <ContactButtons courseTitle="Form" />
    </div>

    <!-- Web Sitesi Bilgisi -->
    <div class="mt-6 text-center text-sm text-gray-500">
      <p>istanbulegitimmerkezi.com</p>
    </div>
  </div>
</Layout>

<!-- JavaScript: Sadece sekme geÃ§iÅŸleri ve form gÃ¶nderimi -->
<script>
  // Sekme geÃ§iÅŸi
  window.switchTab = function(tab) {
    const dersForm = document.getElementById('formDersKaydi');
    const iletisimForm = document.getElementById('formIletisim');
    const tabDers = document.getElementById('tabDersKaydi');
    const tabIletisim = document.getElementById('tabIletisim');
    
    if (tab === 'ders') {
      dersForm.classList.remove('hidden');
      iletisimForm.classList.add('hidden');
      tabDers.className = 'flex-1 py-4 px-6 text-center font-semibold text-lg bg-indigo-600 text-white';
      tabIletisim.className = 'flex-1 py-4 px-6 text-center font-semibold text-lg bg-gray-50 text-gray-700 hover:bg-gray-100';
    } else {
      dersForm.classList.add('hidden');
      iletisimForm.classList.remove('hidden');
      tabDers.className = 'flex-1 py-4 px-6 text-center font-semibold text-lg bg-gray-50 text-gray-700 hover:bg-gray-100';
      tabIletisim.className = 'flex-1 py-4 px-6 text-center font-semibold text-lg bg-indigo-600 text-white';
    }
  };

  // Form gÃ¶nderim iÅŸleyicisi
  async function handleFormSubmit(e) {
    e.preventDefault();
    
    const form = e.target;
    const formData = new FormData(form);
    const submitBtn = form.querySelector('button[type="submit"]');
    const originalText = submitBtn.innerHTML;
    
    submitBtn.disabled = true;
    submitBtn.innerHTML = 'GÃ¶nderiliyor...';
    
    try {
      const response = await fetch('/api/kayit', {
        method: 'POST',
        body: formData
      });
      
      const result = await response.json();
      
      if (response.ok) {
        alert('BaÅŸvurunuz alÄ±ndÄ±! GÃ¼n iÃ§inde sizi bilgilendireceÄŸiz.');
        form.reset();
      } else {
        alert(result.error || 'Bir hata oluÅŸtu. LÃ¼tfen tekrar deneyin.');
      }
    } catch (error) {
      console.error('Form gÃ¶nderim hatasÄ±:', error);
      alert('Bir hata oluÅŸtu. LÃ¼tfen daha sonra tekrar deneyin.');
    } finally {
      submitBtn.disabled = false;
      submitBtn.innerHTML = originalText;
    }
  }

  // Sayfa yÃ¼klendiÄŸinde formlarÄ± dinle
  document.addEventListener('DOMContentLoaded', () => {
    const dersForm = document.getElementById('dersKaydiForm');
    const iletisimForm = document.getElementById('iletisimForm');
    
    if (dersForm) dersForm.addEventListener('submit', handleFormSubmit);
    if (iletisimForm) iletisimForm.addEventListener('submit', handleFormSubmit);
  });
</script>